<!DOCTYPE HTML>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результаты Заказа</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Ваши стили */
    </style>
</head>
<body>
<div class="container">
    <h1 class="title">Результаты Заказа</h1>
    <div class="result" id="result"></div>
    <button class="button" onclick="goBack()">Назад</button>
</div>

<script>
    function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    async function displayOrderDetails() {
        const orderUid = getQueryParameter('order_uid');
        if (!orderUid) {
            document.getElementById('result').innerHTML = '<p>Отсутствует UID заказа в URL.</p>';
            return;
        }

        const response = await fetch(`http://localhost:8080/order/${orderUid}`);
        if (!response.ok) {
            document.getElementById('result').innerHTML = `<p>Ошибка при загрузке данных заказа: ${response.status} ${response.statusText}</p>`;
            return;
        }

        const orderData = await response.json();
        if (!orderData) {
            document.getElementById('result').innerHTML = '<p>Данные заказа не найдены.</p>';
            return;
        }

        // Отображение данных
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
        <h2>Детали Заказа</h2>
        <p><strong>UID Заказа:</strong> ${orderData.order_uid}</p>
        <p><strong>Номер отслеживания:</strong> ${orderData.track_number}</p>
        <h3>Доставка</h3>
        <p><strong>Имя:</strong> ${orderData.delivery.name}</p>
        <p><strong>Телефон:</strong> ${orderData.delivery.phone}</p>
        <p><strong>Город:</strong> ${orderData.delivery.city}</p>
        <p><strong>Адрес:</strong> ${orderData.delivery.address}</p>
        <h3>Оплата</h3>
        <p><strong>Сумма:</strong> ${orderData.payment.amount} ${orderData.payment.currency}</p>
        <p><strong>Итого за товары:</strong> ${orderData.payment.goods_total} ${orderData.payment.currency}</p>
        <p><strong>Стоимость доставки:</strong> ${orderData.payment.delivery_cost} ${orderData.payment.currency}</p>
        <h3>Товары</h3>
        ${orderData.items.map(item => `
            <div class="item">
                <strong>Название:</strong> ${item.name}<br>
                <strong>Цена:</strong> ${item.price} ${orderData.payment.currency}<br>
                <strong>Размер:</strong> ${item.size}<br>
                <strong>Всего:</strong> ${item.total_price} ${orderData.payment.currency}
            </div>
        `).join('')}
    `;
    }

    function goBack() {
        window.history.back();
    }

    // Выводим детали заказа при загрузке страницы
    displayOrderDetails();
</script>
</body>
</html>